# 모바일 Google 로그인 해결책

## 문제 개요

### 발생 에러
- **에러 코드**: `403 disallowed_useragent`
- **에러 메시지**: "Access blocked: secure browser usage policy"
- **발생 환경**: 모바일 브라우저, WebView, 인앱 브라우저

### 원인 분석
- Google OAuth 보안 정책에 따라 특정 User-Agent 차단
- 모바일 환경에서 `signInWithPopup` 방식이 제한됨
- 일부 제조사 브라우저와 인앱 브라우저 호환성 문제

## 해결 방안

### 1. 환경별 인증 방식 분리
```typescript
// 모바일/태블릿: signInWithRedirect
// 데스크톱: signInWithPopup
// Safari: 리디렉션 방식 우선
```

### 2. 디바이스 감지 유틸리티
- **파일**: `src/utils/deviceDetector.ts`
- **기능**: 모바일, 태블릿, 데스크톱 자동 감지
- **브라우저 식별**: Chrome, Safari, Firefox 등
- **문제 브라우저 감지**: WebView, 인앱 브라우저 패턴

### 3. 문제 User-Agent 패턴
```
wv, version/, samsungbrowser, miuibrowser, huaweibrowser,
oppobrowser, vivobrowser, ucbrowser, qqbrowser,
baiduboxapp, weibo, line, kakaotalk, naver
```

### 4. Firebase 보안 헤더 강화
```json
{
  "X-Frame-Options": "SAMEORIGIN",
  "Content-Security-Policy": "frame-ancestors 'self'",
  "Referrer-Policy": "strict-origin-when-cross-origin"
}
```

## 구현 내용

### 주요 파일 수정
1. **`src/utils/deviceDetector.ts`**: 디바이스 감지 유틸리티 신규 생성
2. **`src/firebase/auth.ts`**: Google 로그인 함수 리팩토링
3. **`src/pages/Login.tsx`**: 모바일 경고 UI 및 리디렉션 처리
4. **`firebase.json`**: 보안 헤더 추가

### 사용자 경험 개선
- **자동 방식 선택**: 환경에 따라 최적의 인증 방식 자동 적용
- **Fallback 메커니즘**: 팝업 차단 시 자동 리디렉션 전환
- **명확한 안내**: 문제 발생 시 해결책 안내
- **경고 메시지**: 문제 브라우저에서 사전 경고 표시

## 테스트 결과

### 해결된 문제
- ✅ 모바일 브라우저 팝업 차단 문제
- ✅ "403 disallowed_useragent" 에러 방지
- ✅ WebView/인앱 브라우저 호환성
- ✅ Safari 데스크톱 호환성
- ✅ 사용자 경험 개선

### 지원 환경
- **모바일**: Android Chrome, iOS Safari, 일반 모바일 브라우저
- **데스크톱**: Chrome, Firefox, Safari, Edge
- **제한**: 일부 인앱 브라우저 (경고 표시 후 대안 안내)

## 배포 정보
- **빌드**: 성공 (webpack 5.105.0)
- **배포**: Firebase Hosting
- **테스트**: 모바일 기기에서 정상 동작 확인

---

*이 문서는 모바일 Google 로그인 문제 해결 과정과 결과를 상세히 기록합니다.*
