# Screen Golf HQ Central 프로젝트 전체 구조

## 프로젝트 개요

Screen Golf HQ Central은 스크린 골프 매장을 관리하기 위한 웹 애플리케이션입니다. 본사 관리자와 각 매장 관리자가 역할에 맞는 기능을 사용할 수 있도록 설계되었습니다.

### 기술 스택
- **프론트엔드**: React 19.2.4 + TypeScript
- **스타일링**: TailwindCSS
- **라우팅**: React Router Dom + ProtectedRoute (역할 기반 접근 제어)
- **상태관리**: React Context (AuthContext, NotificationContext)
- **백엔드**: Firebase (Auth, Firestore, Hosting)
- **빌드**: Webpack 5
- **차트**: Recharts

### 시스템 아키텍처
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   본사 관리자    │    │   매장 관리자    │    │   Firebase      │
│   (hq 역할)     │    │  (store 역할)   │    │   (백엔드)      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │  React Web App  │
                    │   (프론트엔드)   │
                    └─────────────────┘
```

## 디렉토리 구조

```
screen-golf-hq-central/
├── .Doc/                    # 📁 프로젝트 문서
├── .firebase/              # Firebase 설정
├── dist/                   # 빌드 결과물
├── node_modules/           # 의존성 패키지
├── public/                 # 정적 파일
├── src/                    # 📁 소스 코드
│   ├── components/         # 📁 재사용 컴포넌트 (11개)
│   │   ├── ChartComponent.tsx
│   │   ├── CountrySelector.tsx
│   │   ├── Header.tsx
│   │   ├── Layout.tsx
│   │   ├── LoadingSpinner.tsx
│   │   ├── LocationCard.tsx
│   │   ├── NotificationContainer.tsx
│   │   ├── NotificationToast.tsx
│   │   ├── ProtectedRoute.tsx
│   │   ├── RoleBasedRedirect.tsx
│   │   └── Sidebar.tsx
│   ├── contexts/           # 📁 전역 상태 관리 (2개)
│   │   ├── AuthContext.tsx
│   │   └── NotificationContext.tsx
│   ├── firebase/           # 📁 Firebase 설정 (2개)
│   │   ├── auth.ts
│   │   └── config.ts
│   ├── pages/              # 📁 메인 페이지 (12개)
│   │   ├── Dashboard.tsx
│   │   ├── Landing.tsx
│   │   ├── Login.tsx
│   │   ├── MembersManagement.tsx
│   │   ├── ReservationsManagement.tsx
│   │   ├── Settings.tsx
│   │   ├── Statistics.tsx
│   │   ├── StoreManager.tsx
│   │   ├── SystemManager.tsx
│   │   └── TournamentsManagement.tsx
│   ├── utils/              # 📁 유틸리티 함수 (3개)
│   ├── data/               # 📁 데이터 관련 (3개)
│   ├── App.tsx             # 메인 앱 컴포넌트
│   ├── index.css           # 전역 스타일
│   └── index.tsx           # 앱 진입점
├── firebase.json           # Firebase 배포 설정
├── firestore.rules         # Firestore 보안 규칙
├── package.json            # 프로젝트 설정
├── tailwind.config.js      # TailwindCSS 설정
├── tsconfig.json           # TypeScript 설정
└── webpack.config.js       # Webpack 설정
```

## 라우팅 구조

### 페이지별 접근 권한 및 기능

| 페이지 | 경로 | 본사 관리자 | 매장 관리자 | 주요 기능 |
|------|------|------------|------------|----------|
| **Landing** | `/` | ✅ | ✅ | 프로젝트 소개 |
| **Login** | `/login` | ✅ | ✅ | 로그인 |
| **Redirect** | `/redirect` | ✅ | ✅ | 로그인 후 역할 기반 리디렉션 |
| **Dashboard** | `/dashboard` | ✅ | ✅ | 대시보드 및 통계 |
| **StoreManager** | `/storemanager` | ✅ | ❌ | 매장 관리 (본사 전용) |
| **SystemManager** | `/system` | ❌ | ✅ | 시스템 관리 (매장 전용) |
| **Settings** | `/settings` | ✅ | ✅ | 설정 관리 |

### 대시보드 레이아웃 구조

대시보드는 본사 관리자와 매장 관리자의 역할을 고려하여 동적으로 표시됩니다:

#### UI 레이아웃
```
[전체] [매장] [일별] [월별] [년별] [달력 선택] ← 컨트롤 그룹 (한 줄 배치)
[총매출 카드] [총거래 카드] ← 통계 카드 (항상 2열)
```

#### 역할별 표시 내용
- **본사 관리자**: 매장 선택 드롭다운으로 특정 매장 또는 전체 매장 선택
- **매장 관리자**: 자신의 매장 통계만 자동 표시

#### 컨트롤 요소
1. **매장 선택** (본사 전용): 특정 매장 또는 전체 매장 선택 (드롭다운)
2. **기간 선택**: 일별/월별/년별 데이터 필터링 (공통)
3. **날짜 선택**: 특정 날짜 데이터 조회 (공통)
4. **통계 카드**: 총매출/총거래 실시간 표시 (공통)

#### 데이터 소스
- **매출 데이터**: Firestore에서 실시간 조회
- **차트 표시**: 기간별 매출 추이 그래프
- **테이블 표시**: 상세 매출 데이터 (데스크톱) / 카드 표시 (모바일)

### 역할 기반 리디렉션
- **본사 관리자(hq)** 로그인 시 → `/redirect` → `/storemanager` 페이지로 자동 이동
- **매장 관리자(store)** 로그인 시 → `/redirect` → `/dashboard` 페이지로 자동 이동
- **리디렉션 로직**: `RoleBasedRedirect` 컴포넌트에서 역할 확인 후 해당 페이지로 이동

## 사이드바 메뉴 구조

### 메뉴 순서
1. 홈으로 (→ `/login`)
2. 매장 관리자 (→ `/storemanager`)
3. 대시보드 (→ `/dashboard`)
4. 시스템 (→ `/system`)
5. 설정 (→ `/settings`)

### 역할별 표시 메뉴
- **본사 관리자**: 홈으로, 매장 관리자, 대시보드, 설정
- **매장 관리자**: 홈으로, 대시보드, 시스템, 설정

### 국가 선택기 개선
- **검색 기능**: 텍스트 입력으로 국가 검색 가능
- **영어 기반**: 모든 국가명 영어로 통일 (South Korea, United States 등)
- **자동 완성**: 부분 일치 검색 지원 (korea → South Korea, North Korea)
- **확장성**: 12개국가 지원 + 별칭 검색 (usa → United States)
- **UI 개선**: 검색 가능한 콤보박스, 부드러운 인터랙션

## 인증 시스템

### Firebase Auth 연동
- **인증 방식**: Google OAuth + 이메일/비밀번호
- **허용된 이메일**: 화이트리스트 기반 (`movare00@gmail.com` 등)
- **역할 관리**: Firestore `users_{국가코드}` 컬렉션에서 관리

### 모바일 Google 로그인 최적화
- **문제점**: 모바일 브라우저에서 "403 disallowed_useragent" 에러 발생
- **해결책**: 환경별 인증 방식 자동 선택
  - **모바일/태블릿**: `signInWithRedirect` 방식 사용
  - **데스크톱**: `signInWithPopup` 방식 유지
  - **Safari**: 리디렉션 방식 우선 적용
- **문제 브라우저 감지**: WebView, 인앱 브라우저 자동 감지 및 경고
- **Fallback 메커니즘**: 팝업 차단 시 자동 리디렉션 방식 전환
- **사용자 안내**: 문제 브라우저에서 대체 방법 안내

### 디바이스 감지 기능
- **모바일 기기**: Android, iPhone, iPad 등 자동 감지
- **문제 User-Agent**: WebView, 제조사 브라우저, 인앱 브라우저 감지
- **브라우저 종류**: Chrome, Safari, Firefox 등 식별
- **최적의 인증 방식**: 환경에 따라 자동 선택

### 보안 강화
- **Firebase 호스팅 헤더**: X-Frame-Options, CSP, Referrer-Policy 추가
- **Google OAuth 호환성**: 보안 정책 준수로 인증 성공률 향상
- **사용자 경험**: 명확한 에러 메시지 및 해결책 안내

### 역할 기반 접근 제어
- **본사 관리자(hq)**: 모든 매장 데이터 접근 가능
- **매장 관리자(store)**: 자기 매장 데이터만 접근 가능

### 국가별 데이터 분리
```
users_KR/    # 한국 사용자
users_US/    # 미국 사용자
users_JP/    # 일본 사용자
users_CN/    # 중국 사용자
...          # 기타 국가
```

## 데이터 모델

### 주요 Firestore 컬렉션
1. **users_{countryCode}**: 사용자 정보
2. **settlements**: 정산 데이터
3. **reservations**: 예약 데이터
4. **members**: 회원 데이터
5. **tournaments**: 토너먼트 데이터

### 데이터 흐름
```
사용자 로그인 → 역할 확인 → 권한에 맞는 데이터 조회 → 화면 표시
```

## 배포 정보
- **배포 플랫폼**: Firebase Hosting
- **배포 URL**: https://screen-golf-hq-central.web.app
- **빌드 명령어**: `npm run build`
- **배포 명령어**: `firebase deploy`

---

*이 문서는 Screen Golf HQ Central 프로젝트의 전체 구조를 개괄적으로 설명합니다. 세부 기능 구현은 별도 문서에서 다룹니다.*
